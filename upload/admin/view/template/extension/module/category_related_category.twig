<div class="form-group" id="category-related-form">
<label class="col-sm-2 control-label" for="input-related"><span data-toggle="tooltip" title="{{ help_related }}">{{ entry_related }}</span></label>
<div class="col-sm-10">
<input type="text" name="related" value="" placeholder="{{ entry_related }}" id="input-related" class="form-control" />
<div id="product-related" class="well well-sm" style="height: 150px; overflow: auto;">
    {% for related_id,related in product_related %}
        <div id="product-related{{ related_id }}"><i class="fa fa-minus-circle"></i>{{ related }}
		<input type="hidden" name="product_related[]" value="{{ related_id }}" />
	</div>
    {% endfor %}
</div>
</div>
</div>

<script type='text/javascript'>
$('input[name=\'related\']').autocomplete({
	'source': function(request, response) {
		$.ajax({
			url: 'index.php?route=catalog/product/autocomplete&user_token={{ user_token }}&filter_{{ category_related_key }}=' +  encodeURIComponent(request),
			dataType: 'json',
			success: function(json) {
				response($.map(json, function(item) {
					return {
						label: item['{{ category_related_key }}'],
						value: item['product_id']
					}
				}));
			}
		});
	},
	'select': function(item) {
		$('input[name=\'related\']').val('');

		$('#product-related' + item['value']).remove();
		$('#product-related').append('<div id="product-related' + item['value'] + '"><i class="fa fa-minus-circle"></i> ' + item['label'] + '<input type="hidden" name="product_related[]" value="' + item['value'] + '" /></div>');
	}
});

$('#product-related').delegate('.fa-minus-circle', 'click', function() {
	$(this).parent().remove();
});
$(document).ready(function (){
    if($('#tab-data').length) {
        var element = $('#category-related-form').detach();
        $('#tab-data').append(element);
    }
});
</script>